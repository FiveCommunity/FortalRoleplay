import "./finishRace.css"

import type React from "react"
import type { FC } from "react"

import { formatTime } from "../utils/formatTime"

interface Record {
  id: number
  name: string
  vehicle: string
  vehicleTag: "premium" | "vip" | "comum"
  time: number
  position?: number
}

interface InRaceComponentProps {
  messageData: {
    values: {
      records: Record[]
      yourRecord?: Record
    }
  }
}

interface ScoreboardProps {
  records: Record[]
}

const ForRaces: FC<ScoreboardProps> = ({ records }) => {
  const scoreboardPos = []
  // Altera o loop para iterar no m√°ximo 4 vezes ou at√© o fim dos records, o que for menor.
  for (let i = 0; i < Math.min(records.length, 4); i++) {
    const record = records[i];
    if (record) { // Garante que o registro existe
      let positionClassName = "";
      if (record.position === 1) {
        positionClassName = "recers2-icon";
      } else if (record.position === 2) {
        positionClassName = "recers2-icon1";
      } else if (record.position === 3) {
        positionClassName = "recers2-icon2";
      } else {
        positionClassName = "recers2-icon3";
      }

      scoreboardPos.push(
        <div className="recers-user" key={record.id}>
          {" "}
          <div className="recers-main">
            <div className={positionClassName}>
              <h1>{record.position}</h1>
            </div>
          </div>
          <div className="recers-player">
            <h1>{record.name}</h1>
            <div className="recers-playerId">
              <h1>#{record.id}</h1>
            </div>
          </div>
          <div className="recers-vehicle">
            <h1>{record.vehicle}</h1>
            <div
              className={`${
                record.vehicleTag === "vip"
                  ? "recers-vehicleTagVip"
                  : record.vehicleTag === "premium"
                  ? "recers-vehicleTagPremium"
                  : "recers-vehicleTagComum"
              }`}
            >
              <p>{record.vehicleTag}</p>
            </div>
          </div>
          <h1 className="recers-time">{formatTime(record.time)}</h1>
        </div>,
      );
    }
  }

  return scoreboardPos;
};

const FinishRaceComponent: React.FC<InRaceComponentProps> = ({ messageData }) => {
  const yourRecord = messageData.values.yourRecord;

  return (
    <>
      <div className="records">
        <div className="ranking-header">
          {yourRecord && yourRecord.position === 1 ? (
            <h1>Voc√™ ganhou!</h1>
          ) : (
            <h1>Sua posi√ß√£o: {yourRecord?.position}¬∫ lugar</h1>
          )}
          <p>Corrida Ilegal! üèÜ</p>
          {yourRecord && yourRecord.position === 1 ? (
            <h1>Voc√™ venceu a corrida ilegal e garantiu o primeiro lugar. Sua recompensa est√° a caminho!</h1>
          ) : (
            <h1>
              Voc√™ completou a corrida ilegal na {yourRecord?.position}¬∫ posi√ß√£o. Continue treinando para alcan√ßar o
              topo!
            </h1>
          )}
          <div className="ranking-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M5.83333 15.8333H17.5V17.0833C17.5 18.6917 16.1917 20 14.5833 20H5.2C5.6 19.4033 5.83333 18.6867 5.83333 17.9167V15.8333ZM15.0125 8.21417L17.73 10.315L18.355 9.87917L17.25 6.52167L20 4.93083V4.16667H16.395L15.415 0.416667H14.6067L13.6258 4.16667H10.0008V4.93583L12.7692 6.47583L11.6833 9.8725L12.285 10.325L15.0142 8.215L15.0125 8.21417ZM8.81833 8.33333H3.33333V6.66667H8.385C8.35083 6.39333 8.33333 6.11583 8.33333 5.83333C8.33333 5.55083 8.35083 5.27333 8.385 5H3.33333V3.33333H8.81833C9.3925 1.915 10.4408 0.739167 11.7667 0.0025C11.7333 0.000833333 11.7 0 11.6667 0H2.5C1.11917 0 0 1.11917 0 2.5V17.7975C0 18.8875 0.784167 19.8808 1.86833 19.9892C3.115 20.1142 4.16667 19.1383 4.16667 17.9167V14.1667H14.1667V12.4483C11.7333 12.145 9.7075 10.53 8.81833 8.33333ZM7.5 11.6667H3.33333V10H7.5V11.6667Z"
                fill="white"
              />
              <path
                d="M5.83333 15.8333H17.5V17.0833C17.5 18.6917 16.1917 20 14.5833 20H5.2C5.6 19.4033 5.83333 18.6867 5.83333 17.9167V15.8333ZM15.0125 8.21417L17.73 10.315L18.355 9.87917L17.25 6.52167L20 4.93083V4.16667H16.395L15.415 0.416667H14.6067L13.6258 4.16667H10.0008V4.93583L12.7692 6.47583L11.6833 9.8725L12.285 10.325L15.0142 8.215L15.0125 8.21417ZM8.81833 8.33333H3.33333V6.66667H8.385C8.35083 6.39333 8.33333 6.11583 8.33333 5.83333C8.33333 5.55083 8.35083 5.27333 8.385 5H3.33333V3.33333H8.81833C9.3925 1.915 10.4408 0.739167 11.7667 0.0025C11.7333 0.000833333 11.7 0 11.6667 0H2.5C1.11917 0 0 1.11917 0 2.5V17.7975C0 18.8875 0.784167 19.8808 1.86833 19.9892C3.115 20.1142 4.16667 19.1383 4.16667 17.9167V14.1667H14.1667V12.4483C11.7333 12.145 9.7075 10.53 8.81833 8.33333ZM7.5 11.6667H3.33333V10H7.5V11.6667Z"
                fill="url(#paint0_radial_883_2)"
                fillOpacity="0.25"
              />
              <path
                d="M17 16.333V17.083C17 18.4152 15.9152 19.5 14.583 19.5H6.02637C6.22369 19.0102 6.33297 18.476 6.33301 17.917V16.333H17ZM2.5 0.5H10.2158C9.49344 1.14834 8.90323 1.94059 8.49121 2.83301H2.83301V5.5H7.84375C7.83869 5.61039 7.83301 5.72129 7.83301 5.83301C7.83301 5.94494 7.83867 6.05639 7.84375 6.16699H2.83301V8.83301H8.49121C9.44698 10.9038 11.3608 12.4411 13.667 12.875V13.667H3.66699V17.917C3.66681 18.8455 2.86732 19.5864 1.91797 19.4912C1.12557 19.412 0.500168 18.6686 0.5 17.7979V2.5C0.5 1.39531 1.39531 0.5 2.5 0.5ZM2.83301 12.167H8V9.5H2.83301V12.167ZM15.0293 0.916992L15.9111 4.29297L16.0088 4.66699H19.458L17 6.08887L16.6484 6.29199L16.7754 6.67773L17.7637 9.68164L17.7451 9.69434L15.8311 8.21484L15.9502 8.12305L15.2373 7.76758L15.2363 7.7666L14.9814 8.17188L14.708 7.81934L12.2803 9.69629L12.2666 9.68555L13.2451 6.62793L13.3701 6.23828L13.0127 6.03906L10.5459 4.66699H14.0117L14.1094 4.29297L14.9932 0.916992H15.0293Z"
                stroke="white"
                strokeOpacity="0.05"
              />
              <defs>
                <radialGradient
                  id="paint0_radial_883_2"
                  cx="0"
                  cy="0"
                  r="1"
                  gradientUnits="userSpaceOnUse"
                  gradientTransform="translate(9.96865 15.3333) scale(12.0063 19.0941)"
                >
                  <stop stopColor="white" />
                  <stop offset="1" stopColor="white" stopOpacity="0" />
                </radialGradient>
              </defs>
            </svg>
            <h1>Resultado da Corrida</h1>
          </div>
        </div>
        <div className="racersRecords">
          <div className="recers-title">
            <h1>POS</h1>
            <h1>CORREDOR</h1>
            <h1>VE√çCULO UTILIZADO</h1>
            <h1>TEMPO RECORDE</h1>
          </div>
          <ForRaces records={messageData.values.records} />
        </div>
        <div className="your-main">
          <div className="line"></div>
          <div className="your-title">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M9.33518 7.41913V10.079C10.3711 10.3095 11.2919 10.6884 12.2564 10.9501V8.28624C11.2244 8.0597 10.2957 7.68083 9.33518 7.41913ZM18.198 2.61489C16.8367 3.23593 15.1617 3.86087 13.5543 3.86087C11.4308 3.86087 9.67255 2.50162 6.99742 2.50162C6.00516 2.50162 5.12006 2.67348 4.29847 2.97033C4.4096 2.6852 4.4612 2.37663 4.44135 2.04854C4.36991 0.939265 3.44513 0.0487227 2.31395 0.00185204C1.04386 -0.0489245 0 0.950983 0 2.18915C0 2.93127 0.377059 3.58746 0.952569 3.98195V19.0626C0.952569 19.5821 1.37726 20 1.90514 20H2.54018C3.06807 20 3.49275 19.5821 3.49275 19.0626V15.3754C4.61599 14.9028 6.01706 14.5122 8.03333 14.5122C10.1607 14.5122 11.9151 15.8715 14.5902 15.8715C16.5033 15.8715 18.0313 15.2348 19.4523 14.274C19.7976 14.0396 20 13.6568 20 13.2428V3.7476C20.004 2.83753 19.0395 2.23211 18.198 2.61489ZM6.41397 12.7155C5.38996 12.821 4.42945 13.0358 3.49275 13.3639V10.6102C4.53264 10.247 5.37805 10.0244 6.41397 9.93062V12.7155ZM18.0988 7.4621C17.1621 7.84488 16.2612 8.22375 15.1776 8.39561V11.1727C16.1619 11.0399 17.2177 10.7118 18.0988 10.1572V12.9108C17.1026 13.5397 16.1738 13.8756 15.1776 13.9693V11.1727C14.106 11.3172 13.2764 11.2313 12.2564 10.954V13.5865C11.3078 13.2975 10.379 12.9342 9.33518 12.7546V10.079C8.55328 9.90719 7.71581 9.81344 6.41397 9.93062V7.1965C5.5249 7.31758 4.64378 7.5949 3.49275 8.01283V5.25918C4.81048 4.78266 5.48124 4.48581 6.41397 4.39988V7.1965C7.48561 7.05198 8.33498 7.14572 9.33518 7.41913V4.78657C10.2758 5.0756 11.2086 5.43885 12.2564 5.61852V8.29015C13.1971 8.49716 14.1457 8.55965 15.1776 8.39561V5.58727C16.2492 5.39979 17.2534 5.05607 18.0988 4.70845V7.4621Z"
                fill="white"
              />
              <path
                d="M9.33518 7.41913V10.079C10.3711 10.3095 11.2919 10.6884 12.2564 10.9501V8.28624C11.2244 8.0597 10.2957 7.68083 9.33518 7.41913ZM18.198 2.61489C16.8367 3.23593 15.1617 3.86087 13.5543 3.86087C11.4308 3.86087 9.67255 2.50162 6.99742 2.50162C6.00516 2.50162 5.12006 2.67348 4.29847 2.97033C4.4096 2.6852 4.4612 2.37663 4.44135 2.04854C4.36991 0.939265 3.44513 0.0487227 2.31395 0.00185204C1.04386 -0.0489245 0 0.950983 0 2.18915C0 2.93127 0.377059 3.58746 0.952569 3.98195V19.0626C0.952569 19.5821 1.37726 20 1.90514 20H2.54018C3.06807 20 3.49275 19.5821 3.49275 19.0626V15.3754C4.61599 14.9028 6.01706 14.5122 8.03333 14.5122C10.1607 14.5122 11.9151 15.8715 14.5902 15.8715C16.5033 15.8715 18.0313 15.2348 19.4523 14.274C19.7976 14.0396 20 13.6568 20 13.2428V3.7476C20.004 2.83753 19.0395 2.23211 18.198 2.61489ZM6.41397 12.7155C5.38996 12.821 4.42945 13.0358 3.49275 13.3639V10.6102C4.53264 10.247 5.37805 10.0244 6.41397 9.93062V12.7155ZM18.0988 7.4621C17.1621 7.84488 16.2612 8.22375 15.1776 8.39561V11.1727C16.1619 11.0399 17.2177 10.7118 18.0988 10.1572V12.9108C17.1026 13.5397 16.1738 13.8756 15.1776 13.9693V11.1727C14.106 11.3172 13.2764 11.2313 12.2564 10.954V13.5865C11.3078 13.2975 10.379 12.9342 9.33518 12.7546V10.079C8.55328 9.90719 7.71581 9.81344 6.41397 9.93062V7.1965C5.5249 7.31758 4.64378 7.5949 3.49275 8.01283V5.25918C4.81048 4.78266 5.48124 4.48581 6.41397 4.39988V7.1965C7.48561 7.05198 8.33498 7.14572 9.33518 7.41913V4.78657C10.2758 5.0756 11.2086 5.43885 12.2564 5.61852V8.29015C13.1971 8.49716 14.1457 8.55965 15.1776 8.39561V5.58727C16.2492 5.39979 17.2534 5.05607 18.0988 4.70845V7.4621Z"
                fill="url(#paint0_radial_888_2)"
                fillOpacity="0.25"
              />
              <path
                d="M9.83496 8.08887C10.0894 8.16926 10.3472 8.25505 10.6152 8.3418C10.9804 8.45997 11.3602 8.57752 11.7568 8.67969V10.2793C11.5024 10.1989 11.245 10.1143 10.9775 10.0273C10.6126 9.90861 10.2328 9.78901 9.83496 9.68555V8.08887ZM12.7568 5.19727L12.3408 5.12598C11.3353 4.95356 10.4672 4.61121 9.48242 4.30859L8.83496 4.10938V6.78613C8.20081 6.65514 7.59091 6.60294 6.91406 6.64648V3.85156L6.36816 3.90234C5.35363 3.99581 4.60115 4.32659 3.32227 4.78906L2.99316 4.9082V8.72656L3.66309 8.48242C4.55085 8.16008 5.25485 7.93177 5.91406 7.79199V9.4834C5.02227 9.6014 4.23997 9.82015 3.32812 10.1387L2.99316 10.2549V14.0684L3.6582 13.8359C4.55726 13.521 5.47924 13.3144 6.46484 13.2129L6.91406 13.167V10.3945C7.70833 10.3505 8.30208 10.399 8.83496 10.4912V13.1758L9.25 13.2471C10.2527 13.4196 11.1151 13.7612 12.1104 14.0645L12.7568 14.2617V11.5859C13.3978 11.7181 14.0023 11.7675 14.6777 11.7227V14.5186L15.2246 14.4668C16.3113 14.3645 17.3143 13.9973 18.3652 13.334L18.5986 13.1865V9.25195L17.832 9.73438C17.1869 10.1404 16.4293 10.4165 15.6777 10.5762V8.81152C16.6441 8.60697 17.4766 8.25642 18.2881 7.9248L18.5986 7.79785V3.96191L17.9082 4.24609C17.0827 4.5855 16.1153 4.91562 15.0918 5.09473L14.6777 5.16699V7.9541C14.0146 8.01922 13.3841 7.98506 12.7568 7.87695V5.19727ZM1.45215 3.71875L1.23535 3.56934C0.788117 3.26275 0.500103 2.75727 0.5 2.18945C0.5 1.24142 1.30124 0.461887 2.29297 0.500977C3.12049 0.535265 3.79846 1.14916 3.9248 1.92383L3.94238 2.08105C3.95743 2.33531 3.91792 2.57122 3.83301 2.78906L3.43262 3.81445L4.46875 3.44043C5.23791 3.16257 6.06538 3.00199 6.99707 3.00195C8.24874 3.00195 9.29193 3.31781 10.3271 3.65625C11.3437 3.98858 12.3969 4.36133 13.5547 4.36133C15.2754 4.36122 17.0325 3.69558 18.4053 3.06934V3.07031C18.9295 2.83186 19.5021 3.21605 19.5 3.74512V13.2432C19.4999 13.4907 19.3799 13.7179 19.1719 13.8594C17.8097 14.7805 16.3776 15.3711 14.5898 15.3711C13.3383 15.371 12.2964 15.0552 11.2617 14.7168C10.2455 14.3844 9.19291 14.0127 8.03320 14.0127C5.94453 14.0127 4.47777 14.419 3.29883 14.915L2.99316 15.043V19.0625C2.99316 19.2983 2.79937 19.5 2.54004 19.5H1.90527C1.64594 19.5 1.45215 19.2983 1.45215 19.0625V3.71875Z"
                stroke="white"
                strokeOpacity="0.05"
              />
              <defs>
                <radialGradient
                  id="paint0_radial_888_2"
                  cx="0"
                  cy="0"
                  r="1"
                  gradientUnits="userSpaceOnUse"
                  gradientTransform="translate(9.96865 15.3333) scale(12.0063 19.0941)"
                >
                  <stop stopColor="white" />
                  <stop offset="1" stopColor="white" stopOpacity="0" />
                </radialGradient>
              </defs>
            </svg>
            <h1>Seu Resultado</h1>
          </div>
          {yourRecord && (
            <div className="recers-user">
              <div className="recers-main">
                <div className="recers2-icon3">
                  <h1>{yourRecord.position}</h1>
                </div>
              </div>
              <div className="recers-player">
                <h1>{yourRecord.name}</h1>
                <div className="recers-playerId">
                  <h1>#{yourRecord.id}</h1>
                </div>
              </div>
              <div className="recers-vehicle">
                <h1>{yourRecord.vehicle}</h1>
                <div
                  className={`${
                    yourRecord.vehicleTag === "vip"
                      ? "recers-vehicleTagVip"
                      : yourRecord.vehicleTag === "premium"
                      ? "recers-vehicleTagPremium"
                      : "recers-vehicleTagComum"
                  }`}
                >
                  <p>{yourRecord.vehicleTag}</p>
                </div>
              </div>
              <h1 className="recers-time">{formatTime(yourRecord.time)}</h1>
            </div>
          )}
          <p>Pressione qualquer tecla para fechar.</p>
        </div>
      </div>
    </>
  );
};

export { FinishRaceComponent };